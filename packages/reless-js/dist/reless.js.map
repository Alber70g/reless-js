{"version":3,"file":"reless.js","sources":["../src/index.js"],"sourcesContent":["export default class Reless {\n  constructor(initializer) {\n    initializer = initializer || {}\n    this.appState = { ...initializer.state }\n    let reducers = { ...initializer.reducers }\n    let events = { ...initializer.events }\n    this.events = events\n\n    const devTools = window.__REDUX_DEVTOOLS_EXTENSION__\n      ? window.__REDUX_DEVTOOLS_EXTENSION__.connect()\n      : undefined\n    devTools && devTools.init(this.appState)\n    devTools && (reducers.setState = payload => JSON.parse(payload))\n\n    // Wrap all reducers so they can be called directly\n    this.reducers = Object.keys(reducers).reduce((acc, name) => {\n      const reducer = reducers[name]\n      // wrap the reducer in a function accepting the payload\n      acc[name] = payload => {\n        if (typeof payload === 'function') {\n          payload = payload(this.state)\n        }\n        // call the reducer with the payload\n        let withState = reducer(payload)\n        // define withReducers and fromWithReducers to be able to _merge lateron\n        let withReducers = null\n        let fromWithReducers = null\n        if (typeof withState === 'function') {\n          // the reducer returned another function (withStateFn),\n          // call withStateFn with the state\n          withReducers = withState(this.appState)\n          if (typeof withReducers === 'function') {\n            // the withStateFn returned a function (withReducersFn)\n            // call withReducersFn with the reducers\n            fromWithReducers = withReducers(this.reducers)\n          }\n        }\n        // _merge the result of either function with the current state\n        this.appState = this._merge(\n          this.appState,\n          fromWithReducers || withReducers || withState,\n        )\n        // send to redux dev tools\n        name !== 'setState' &&\n          devTools &&\n          devTools.send({ type: name, payload }, this.appState)\n        if (events.newState) events.newState(this.state)\n      }\n      return acc\n    }, {})\n\n    devTools &&\n      devTools.subscribe(message => {\n        message.type === 'DISPATCH' &&\n          message.state &&\n          this.reducers.setState(message.state)\n      })\n  }\n\n  get state() {\n    return Object.freeze({ ...this.appState })\n  }\n\n  _merge(a, b) {\n    for (var i in b) {\n      a[i] = b[i]\n    }\n    return a\n  }\n}\n"],"names":["Reless","initializer","appState","state","reducers","events","devTools","window","__REDUX_DEVTOOLS_EXTENSION__","connect","undefined","init","setState","JSON","parse","payload","Object","keys","reduce","acc","name","reducer","withState","withReducers","fromWithReducers","_merge","send","type","newState","subscribe","message","a","b","i","freeze"],"mappings":";;;;;;;;;;;;IAAqBA;kBACPC,WAAZ,EAAyB;;;;;kBACTA,eAAe,EAA7B;SACKC,QAAL,gBAAqBD,YAAYE,KAAjC;QACIC,wBAAgBH,YAAYG,QAA5B,CAAJ;QACIC,sBAAcJ,YAAYI,MAA1B,CAAJ;SACKA,MAAL,GAAcA,MAAd;;QAEMC,WAAWC,OAAOC,4BAAP,GACbD,OAAOC,4BAAP,CAAoCC,OAApC,EADa,GAEbC,SAFJ;gBAGYJ,SAASK,IAAT,CAAc,KAAKT,QAAnB,CAAZ;iBACaE,SAASQ,QAAT,GAAoB;aAAWC,KAAKC,KAAL,CAAWC,OAAX,CAAX;KAAjC;;;SAGKX,QAAL,GAAgBY,OAAOC,IAAP,CAAYb,QAAZ,EAAsBc,MAAtB,CAA6B,UAACC,GAAD,EAAMC,IAAN,EAAe;UACpDC,UAAUjB,SAASgB,IAAT,CAAhB;;UAEIA,IAAJ,IAAY,mBAAW;YACjB,OAAOL,OAAP,KAAmB,UAAvB,EAAmC;oBACvBA,QAAQ,MAAKZ,KAAb,CAAV;;;YAGEmB,YAAYD,QAAQN,OAAR,CAAhB;;YAEIQ,eAAe,IAAnB;YACIC,mBAAmB,IAAvB;YACI,OAAOF,SAAP,KAAqB,UAAzB,EAAqC;;;yBAGpBA,UAAU,MAAKpB,QAAf,CAAf;cACI,OAAOqB,YAAP,KAAwB,UAA5B,EAAwC;;;+BAGnBA,aAAa,MAAKnB,QAAlB,CAAnB;;;;cAICF,QAAL,GAAgB,MAAKuB,MAAL,CACd,MAAKvB,QADS,EAEdsB,oBAAoBD,YAApB,IAAoCD,SAFtB,CAAhB;;iBAKS,UAAT,IACEhB,QADF,IAEEA,SAASoB,IAAT,CAAc,EAAEC,MAAMP,IAAR,EAAcL,gBAAd,EAAd,EAAuC,MAAKb,QAA5C,CAFF;YAGIG,OAAOuB,QAAX,EAAqBvB,OAAOuB,QAAP,CAAgB,MAAKzB,KAArB;OA5BvB;aA8BOgB,GAAP;KAjCc,EAkCb,EAlCa,CAAhB;;gBAqCEb,SAASuB,SAAT,CAAmB,mBAAW;cACpBF,IAAR,KAAiB,UAAjB,IACEG,QAAQ3B,KADV,IAEE,MAAKC,QAAL,CAAcQ,QAAd,CAAuBkB,QAAQ3B,KAA/B,CAFF;KADF,CADF;;;;;2BAYK4B,GAAGC,GAAG;WACN,IAAIC,CAAT,IAAcD,CAAd,EAAiB;UACbC,CAAF,IAAOD,EAAEC,CAAF,CAAP;;aAEKF,CAAP;;;;wBARU;aACHf,OAAOkB,MAAP,cAAmB,KAAKhC,QAAxB,EAAP;;;;;;;;;;;;;"}